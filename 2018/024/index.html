<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta name=author content="Mogeko"><meta name=description content="Mogeko 的个人博客"><meta name=keywords content="blog,KMS,Hugo,GNU/Linux,Linux,Ubuntu,Rusty Lake: Roots,Hollow Knight,空洞骑士"><link rel=prev href=https://mogeko.me/2018/023/><link rel=next href=https://mogeko.me/2018/025/><link rel=canonical href=https://mogeko.me/2018/024/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><title>为 Hugo 添加谈笑风生区 (Gitalk) | Mogeko`s Blog</title><meta name=title content="为 Hugo 添加谈笑风生区 (Gitalk) | Mogeko`s Blog"><link rel=stylesheet href=/css/main.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/mogeko.me"},"articleSection":"posts","name":"为 Hugo 添加谈笑风生区 (Gitalk)","headline":"为 Hugo 添加谈笑风生区 (Gitalk)","description":"Hugo 是一个强大的静态网页生成器，使用 go 开发。速度贼快，还有 “时时预览” 等特性。不过 Hugo 还比较年轻，没有像 NexT 那样功能强大，成熟稳定的主题。所以很多","inLanguage":"zh-cn","author":"Mogeko","creator":"Mogeko","publisher":"Mogeko","accountablePerson":"Mogeko","copyrightHolder":"Mogeko","copyrightYear":"2018","datePublished":"2018-11-16 12:57:09 \x2b0800 \x2b0800","dateModified":"2018-11-16 12:57:09 \x2b0800 \x2b0800","url":"https:\/\/mogeko.me\/2018\/024\/","wordCount":"1084","keywords":["Hugo","Mogeko`s Blog"]}</script></head><body><div class=wrapper><nav class=navbar><progress class=content_progress max=0 value=0></progress><div class=container><div class="navbar-header header-back2home-logo"><span class=logo_mark>>$</span>
<a href=https://mogeko.me><span class=logo_text>cd /home/</span>
<span class=logo_cursor></span></a></div><div class=navbar-right><span class=menu><a class=menu-item href=/tools/>Tools</a>
<a class=menu-item href=/posts/>Blog</a>
<a class=menu-item href=/categories/>Categories</a>
<a class=menu-item href=/tags/>Tags</a>
<a class=menu-item href=/about/>About</a>
<a class=menu-item href=/tools/></a><a class=menu-item href=/about/ title=Mogeko>Mogeko</a>
<span class=divide></span><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></span></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><progress class=content_progress max=0 value=0></progress><div class=container><div class=navbar><div class="navbar-header header-logo"><a href=https://mogeko.me>Mogeko`s Blog</a></div><div class=navbar-right><div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></div><div class=menu-toggle><span></span><span></span><span></span></div></div></div><div class=menu id=mobile-menu><nav class=mb-md><a class=menu-item href=/tools/><h3>Tools</h3><div class=menu-active></div></a><a class=menu-item href=/posts/><h3>Blog</h3><div class=menu-active></div></a><a class=menu-item href=/categories/><h3>Categories</h3><div class=menu-active></div></a><a class=menu-item href=/tags/><h3>Tags</h3><div class=menu-active></div></a><a class=menu-item href=/about/><h3>About</h3><div class=menu-active></div></a><a class=menu-item href=/tools/><h3></h3><div class=menu-active></div></a><a class=menu-item href=/about/ title=Mogeko><h3>Mogeko</h3><div class=menu-active></div></a></nav></div></div></nav><main class=main><div class=container><article class=post-warp itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline">为 Hugo 添加谈笑风生区 (Gitalk)</h1><div class=post-meta>Written by <a itemprop=name href=https://mogeko.me rel=author>Mogeko</a> with ♥
<span class=post-time>on <time datetime=2018-11-16 itemprop=datePublished>November 16, 2018</time></span>
in
<i class="iconfont icon-folder"></i><span class=post-category><a href=https://mogeko.me/categories/%E6%8A%98%E8%85%BE%E5%8D%9A%E5%AE%A2%E7%9A%84%E4%BA%8C%E4%B8%89%E4%BA%8B/>折腾博客的二三事,</a></span>
<span class=post-word-count>1084 words</span></div></header><div class=post-content><p><a href=https://gohugo.io>Hugo</a> 是一个强大的静态网页生成器，使用 go 开发。速度贼快，还有 “时时预览” 等特性。不过 Hugo 还比较年轻，没有像 <a href=https://theme-next.iissnan.com>NexT</a> 那样功能强大，成熟稳定的主题。所以很多东西需要自己动手撸。</p><p>就例如评论系统。</p><h2 id=关于-gitalk>关于 Gitalk</h2><img src=https://mogeko.github.io/blog-images/r/024/gitalk.png alt=Gitalk><ul><li>官方网址： <a href=https://github.com/gitalk/gitalk/>https://github.com/gitalk/gitalk/</a></li><li>在线示例： <a href=https://gitalk.github.io/>https://gitalk.github.io/</a></li></ul><p>Gitalk 是一个基于 GitHub Issue 和 Preact 开发的评论插件。它支持多种语言 (包括 en、zh-CN、zh-TW、es-ES、fr)，并自动判断当前语言。最重要的是 Gitalk 使用的是 GitHub Issue 的 api，不依赖任何第三方平台。也就是说，只要 Github 不倒闭，你的评论系统就不会被关闭。</p><h2 id=添加谈笑风生区>添加谈笑风生区</h2><p>本博客使用的主题是：<a href=https://github.com/liuzc/LeaveIt>Leavelt</a></p><p>不同主题可能有所区别，但原理都是类似的</p><h3 id=原理>原理</h3><p>众所周知，Hugo 会将 <strong>Markdown 文档</strong> 按照 <strong>主题 (包括 HTML 模板、CSS、JavaScript 等)</strong> 编译成静态网页</p><p>那么我们只需要将 Gitalk 作为一个 <code>&lt;div></code> 插入到 HTML 模板中，然后在 <code>config.toml</code> 中添加相关配置，就可以实现“谈笑风生区”了</p><h3 id=创建-github-application>创建 Github Application</h3><p>首先要去 GitHub 上创建一个 <a href=https://github.com/settings/applications/new>Github Application</a></p><p><img src=https://mogeko.github.io/blog-images/r/024/get_Github_Application.png alt="Github Application"></p><p>点击创建</p><p>记下 <code>Client ID</code> 和 <code>Client Secret</code>，以后要用</p><p><img src=https://mogeko.github.io/blog-images/r/024/get_id&secret.png alt="Client ID & Client Secret"></p><h3 id=添加-gitalkhtml-模板>添加 gitalk.html 模板</h3><p>接下来为主题添加 <code>gitalk.html</code> 模板。</p><p>在主题的 <code>layouts/partials</code> 文件夹中创建 <code>gitalk.html</code> 文件，写下如下代码</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>{{ if .Site.Params.enableGitalk }}
&lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;gitalk-container&#34;</span>&gt;&lt;/<span style=color:#f92672>div</span>&gt;
&lt;<span style=color:#f92672>link</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;stylesheet&#34;</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://unpkg.com/gitalk/dist/gitalk.css&#34;</span>&gt;
&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://unpkg.com/gitalk/dist/gitalk.min.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
&lt;<span style=color:#f92672>script</span>&gt;
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>gitalk</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Gitalk</span>({
    <span style=color:#a6e22e>clientID</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;{{ .Site.Params.Gitalk.clientID }}&#39;</span>,
    <span style=color:#a6e22e>clientSecret</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;{{ .Site.Params.Gitalk.clientSecret }}&#39;</span>,
    <span style=color:#a6e22e>repo</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;{{ .Site.Params.Gitalk.repo }}&#39;</span>,
    <span style=color:#a6e22e>owner</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;{{ .Site.Params.Gitalk.owner }}&#39;</span>,
    <span style=color:#a6e22e>admin</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#39;{{ .Site.Params.Gitalk.owner }}&#39;</span>],
    <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>location</span>.<span style=color:#a6e22e>pathname</span>, <span style=color:#75715e>// Ensure uniqueness and length less than 50
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>distractionFreeMode</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span> <span style=color:#75715e>// Facebook-like distraction free mode
</span><span style=color:#75715e></span>  });
  (<span style=color:#66d9ef>function</span>() {
    <span style=color:#66d9ef>if</span> ([<span style=color:#e6db74>&#34;localhost&#34;</span>, <span style=color:#e6db74>&#34;127.0.0.1&#34;</span>].<span style=color:#a6e22e>indexOf</span>(window.<span style=color:#a6e22e>location</span>.<span style=color:#a6e22e>hostname</span>) <span style=color:#f92672>!=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>) {
      document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;gitalk-container&#39;</span>).<span style=color:#a6e22e>innerHTML</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Gitalk comments not available by default when the website is previewed locally.&#39;</span>;
      <span style=color:#66d9ef>return</span>;
    }
    <span style=color:#a6e22e>gitalk</span>.<span style=color:#a6e22e>render</span>(<span style=color:#e6db74>&#39;gitalk-container&#39;</span>);
  })();
&lt;/<span style=color:#f92672>script</span>&gt;
{{ end }}
</code></pre></div><h3 id=定位放-gitalk-的位置>定位放 Gitalk 的位置</h3><p>然后使用 Chrome 自带的 DevTools 分析一下网页结构，找到放 Gitalk 的位置</p><p><img src=https://mogeko.github.io/blog-images/r/024/get_class.png alt="get id or class"></p><p>我们可以看见已经 Leavelt 为我们预留了 “谈笑风生区” 的位置，不过里面什么东西都没有。记下该 <code>div</code> 的<code>class</code> 或者 <code>id</code> (如果你使用的主题没有预留 “谈笑风生区”，可以记下你准备放 Gitalk 的位置附近 <code>div</code> 的<code>class</code> 或者 <code>id</code>，并以此定位)</p><p>打开 VSCode，搜索包含刚刚找到的 <code>class</code> 或者 <code>id</code> 的 HTML 模板 (一般是 <code>single.html</code>)</p><p><img src=https://mogeko.github.io/blog-images/r/024/set_div.png alt="插入 Gitalk 模板"></p><p>在模板中插入<code> {{ partial "gitalk.html" . }}</code></p><h3 id=配置-configtoml>配置 config.toml</h3><p>在 <code>config.toml</code> 中添加以下配置</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml>[<span style=color:#a6e22e>params</span>]
  <span style=color:#a6e22e>enableGitalk</span> = <span style=color:#66d9ef>true</span>

[<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>gitalk</span>] 
    <span style=color:#a6e22e>clientID</span> = <span style=color:#e6db74>&#34;[Client ID]&#34;</span> <span style=color:#75715e># Your client ID</span>
    <span style=color:#a6e22e>clientSecret</span> = <span style=color:#e6db74>&#34;[Client Secret]&#34;</span> <span style=color:#75715e># Your client secret</span>
    <span style=color:#a6e22e>repo</span> = <span style=color:#e6db74>&#34;mogeko.github.io&#34;</span> <span style=color:#75715e># The repo to store comments</span>
    <span style=color:#a6e22e>owner</span> = <span style=color:#e6db74>&#34;Mogeko&#34;</span> <span style=color:#75715e># Your GitHub ID</span>
    <span style=color:#a6e22e>admin</span>= <span style=color:#e6db74>&#34;Mogeko&#34;</span> <span style=color:#75715e># Required. Github repository owner and collaborators. (Users who having write access to this repository)</span>
    <span style=color:#a6e22e>id</span>= <span style=color:#e6db74>&#34;location.pathname&#34;</span> <span style=color:#75715e># The unique id of the page.</span>
    <span style=color:#a6e22e>labels</span>= <span style=color:#e6db74>&#34;gitalk&#34;</span> <span style=color:#75715e># Github issue labels. If you used to use Gitment, you can change it</span>
    <span style=color:#a6e22e>perPage</span>= <span style=color:#ae81ff>15</span> <span style=color:#75715e># Pagination size, with maximum 100.</span>
    <span style=color:#a6e22e>pagerDirection</span>= <span style=color:#e6db74>&#34;last&#34;</span> <span style=color:#75715e># Comment sorting direction, available values are &#39;last&#39; and &#39;first&#39;.</span>
    <span style=color:#a6e22e>createIssueManually</span>= <span style=color:#66d9ef>false</span> <span style=color:#75715e># If it is &#39;false&#39;, it is auto to make a Github issue when the administrators login.</span>
    <span style=color:#a6e22e>distractionFreeMode</span>= <span style=color:#66d9ef>false</span> <span style=color:#75715e># Enable hot key (cmd|ctrl + enter) submit comment.</span>
</code></pre></div><p>将 <code>[Client ID]</code> 替换为 Github Application 的 Client ID</p><p>将 <code>[Client Secret]</code> 替换为 Github Application 的 Client Secret</p><p>将 <code>repo</code> 设置为你的博客的地址</p><p>将 <code>owner</code> 和 <code>admin</code> 设置为你的 GitHub ID</p><p>更多配置请参考：<a href=https://github.com/gitalk/gitalk>https://github.com/gitalk/gitalk</a></p><p>设置好后，将编译好的网站推送到 GitHub 上，不出意外的话应该就可以看见评论框了 (Gitalk 在 <code>hugo server</code> 中是不会启用的)</p><p><img src=https://mogeko.github.io/blog-images/r/024/done.png alt=Gitalk></p><p><strong>添加谈笑风生区后还不能立即使用，需要用你的 GitHub 账号登陆并初始化。每篇博客都要</strong></p><h2 id=相关文章>相关文章</h2><ul><li><a href=https://mogeko.github.io/2018/018/><strong>使用 Hugo + GitHub Pages 搭建个人博客</strong></a></li><li><a href=https://mogeko.github.io/2018/028/><strong>使用 Travis CI 自动部署 Hugo 博客</strong></a></li><li><a href=https://mogeko.github.io/2018/033/><strong>为 Hugo 博客添加字数统计</strong></a></li><li><a href=https://mogeko.github.io/2018/025/><strong>Leavelt 主题优化</strong></a></li><li><a href=https://mogeko.github.io/2019/048/><strong>为博客添加独立域名</strong></a></li><li><a href=https://mogeko.github.io/2019/056/><strong>为博客添加免费的 CDN (Cloudflare)</strong></a></li><li><a href=https://mogeko.github.io/2019/070/><strong>为 LeaveIt 主题添加阅读进度条</strong></a></li></ul><br><center>·End·</center></div><div class=post-copyright><p class=copyright-item><span>Author:</span>
<span>Mogeko</span></p><p class=copyright-item><span>Link:</span>
<a href=https://mogeko.me/2018/024/>https://mogeko.me/2018/024/</span></p><p class="copyright-item lincese">本文采用<a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/ target=_blank>知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p></div><div class=post-tags><section><i class="iconfont icon-tag"></i>Tag(s):
<span class=tag><a href=https://mogeko.me/tags/hugo/>#Hugo</a></span></section><section><a href=javascript:window.history.back();>back</a></span> ·
<span><a href=https://mogeko.me>home</a></span></section></div><div class=post-nav><a href=https://mogeko.me/2018/023/ class=prev rel=prev title="Rusty Lake: Roots 通关攻略"><i class="iconfont icon-left"></i>&nbsp;Rusty Lake: Roots 通关攻略</a>
<a href=https://mogeko.me/2018/025/ class=next rel=next title="Leavelt 主题优化">Leavelt 主题优化&nbsp;<i class="iconfont icon-right"></i></a></div><div class=post-comment><div id=gitalk-container></div><link rel=stylesheet href=https://cdn.bootcss.com/gitalk/1.5.2/gitalk.css><script src=https://cdn.bootcss.com/gitalk/1.5.2/gitalk.min.js></script><script>const gitalk=new Gitalk({clientID:'936cecdd2ab935870ca5',clientSecret:'39cfc7a3cb9a974b6609f3fdaa637e2917e3e40a',repo:'blog-commits',owner:'Mogeko',admin:['Mogeko'],id:location.pathname,distractionFreeMode:false});(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('gitalk-container').innerHTML='Gitalk comments not available by default when the website is previewed locally.';return;}
gitalk.render('gitalk-container');})();</script></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span itemprop=copyrightYear>2017 - 2020</span>
<span class=with-love><i class="iconfont icon-love"></i></span><span class=author itemprop=copyrightHolder><a href=https://mogeko.me>Mogeko</a> |</span>
<span>Powered by <a href=https://gohugo.io/ target=_blank rel="external nofollow">Hugo</a> & <a href=https://github.com/Mogeko/Mogege target=_blank rel="external nofollow">Mogege</a></span></div></footer><script src=/js/vendor_main.min.js defer></script><script src=https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js></script><script>pangu.spacingPage();</script></div></body></html>